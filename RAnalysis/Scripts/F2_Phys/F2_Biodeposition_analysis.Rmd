---
title: "F2_Biodeposition_analysis"
author: "Samuel Gurr"
date: "2024-01-10"
output: html_document
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# SET WORKING DIRECTORY 
# knitr::opts_knit$set(root.dir = "C:/Users/katherine.mcfarland/Documents/GitHub/EAD-ASEB-Airradians_multigen_OA/larvae") # Katie's
knitr::opts_knit$set(root.dir = "C:/Users/samjg/Documents/Github_repositories/EAD-ASEB-Airradians_Larvae_crossgen_OA/RAnalysis") # Sam's
knitr::opts_knit$set(root.dir = "C:/Users/samuel.gurr/Documents/Github_repositories/EAD-ASEB-Airradians_multigen_OA/RAnalysis") # Sam's
```



```{r load libraries}

library(ggplot2)
library(dplyr)
library(car)
library(purrr)
library(rstatix)
library(forcats)
```


```{r load data}

# F1s
Biodep_Master_F1 <- read.csv("Output/Biodeposition/F1/F1_Biodeposition_master.csv", header = T)
nrow(Biodep_Master_F1) # 43

Biodep_Master_F2 <- read.csv("Output/Biodeposition/F2/F2_Biodeposition_master.csv", header = T)
nrow(Biodep_Master_F2) # 61
Biodep_Master_F2 <- na.omit(Biodep_Master_F2) 
nrow(Biodep_Master_F2) # 61 - no NAs



# format it
Biodep_Master_F1 <- Biodep_Master_F1 %>% 
                        dplyr::mutate(Age = case_when(Date == "20220302" ~  219, 
                                                       Date == "20220923" ~  424, 
                                                       Date == "20221027" ~  261)) %>% 
                        dplyr::mutate(pCO2 = case_when(treatment == 8 ~ "500 μatm", # add column for pCO2
                                                       treatment == 7.5 ~ "800 μatm")) %>% # %>% #edit this!
                        dplyr::mutate(pCO2 = fct_relevel(pCO2, c("500 μatm","800 μatm")),
                                      Temperature = case_when(Date == "20220302" ~  16,
                                                              Date == "20220923" ~  20,
                                                              Date == "20221027" ~  12)) %>% 
                        dplyr::mutate(Gen = 'F1')

Biodep_Master_F2 <- Biodep_Master_F2 %>% 
                        dplyr::mutate(Age = case_when(Date == "20230201" ~  190, 
                                                       Date == "20230224" ~  213, 
                                                       Date == "20230328" ~  245)) %>% 
                        dplyr::mutate(pCO2 = case_when(treatment == 8 ~ "500 μatm", # add column for pCO2
                                                       treatment == 7.5 ~ "800 μatm",
                                                       treatment == 7 ~ "1200 μatm")) %>% # %>% #edit this!
                        dplyr::mutate(pCO2 = fct_relevel(pCO2, c("500 μatm","800 μatm")),
                                      Temperature = case_when(Date == "20230201" ~  16,
                                                              Date == "20230224" ~  16,
                                                              Date == "20230328" ~  16)) %>% 
                        dplyr::mutate(Gen = 'F2')

# Figures for presentation NOAa 2024
Biodep_Master <- rbind(Biodep_Master_F1,Biodep_Master_F2)

Biodep_Master_200dpf <- Biodep_Master %>% dplyr::filter(Age == c(219, 213))

```


```{r Figures for NOAA presnetation 2024}

F1F2_OIR_MEANS <- Rmisc::summarySE(Biodep_Master_200dpf, measurevar="OIR", 
                              groupvars=c("Gen", "Age", "pCO2"))

F1F2_OIR_Plot  <- F1F2_OIR_MEANS %>% 
                          dplyr::filter(!pCO2 %in% "1200 μatm") %>% 
                          ggplot(aes(x=as.factor(Age), 
                                     y=OIR, 
                                     color=as.factor(pCO2))) +
                          geom_point(position=position_dodge(.5), size = 4)+ 
                          scale_color_manual(values=c("forestgreen",
                                                      "darkorange2"))+
                          geom_errorbar(aes(ymin=OIR-se, 
                                            ymax=OIR+se), width=.2,
                                        position=position_dodge(.5))+
                          ggtitle("Organic Ingestion Rate") +
                          theme_classic() +  
                          xlab("Age (dpf)") +
                         #xlab("Age (d)") +
                          theme(panel.grid.major = element_blank(), 
                                panel.grid.minor = element_blank(),
                                legend.position = "none")+ 
                          scale_y_continuous(name ="Orgnaic Ingestion Rate")+
                          geom_line(stat = "identity", size=1.0)+
                          theme(text = element_text(size=10)) + 
                          facet_wrap(~Gen, scales = "free_x")

pdf(paste0("Output/Biodeposition/F2/F1F2_OIR.pdf"), width = 5, height= 4)
print(F1F2_OIR_Plot)
dev.off()


```

## Statistics function 'runstats'
```{r Statistic function}


runanova <- function(datafilename,  outputfilename) {
            # variables for both for loops
            DF_loop           <- data.frame(matrix(nrow = 1, ncol = 12)) # create dataframe to save during for loop
            colnames(DF_loop) <- c('Age_DPF', 'Metric', 'ShapiroWilk', 'ResidNorm', 
                                   'Levenes', 'HomogVar', 'model', 
                                   'DF.num' , 'DF.denom', 
                                   'F_val','P_val', 'SigDif') # names for comuns in the for loop
            
            unique(datafilename$Age)
            outputfilename <- data.frame()

            for (m in 1:length(unique(datafilename$type))) { # call the biodep metrics one by one
              
            DPvar_loop <- unique(as.character(datafilename$type))
            Data_DPvar <- datafilename %>% 
                                select(type, GROUPvar, DPvar, INDvar) %>% 
                                dplyr::filter(type %in%  DPvar_loop[m])
              
            
            for (i in 1:length(unique(datafilename$Age))) {
              GROUPvar_loop <- unique(datafilename$GROUPvar)[i]
              Data_all      <- datafilename %>% dplyr::filter(GROUPvar %in% GROUPvar_loop)
              # Data_mean   <- Data_all %>% summarySE(measurevar="DPvar", 
              #                                       groupvars=c("group1","Tank_Replicate", "INDvar")) 
              
              AOVmod      <- aov(lm(Data_all$DPvar ~ as.factor(Data_all$INDvar))) # CHANGE HERE!
              KWmod       <- kruskal.test(Data_all$DPvar  ~ as.factor(Data_all$INDvar)) # CHANGE HERE!
              
              # DF_loop$About <- paste0("Gonad: All bfactor + mean by replicate")
              # DF_loop$About <- paste0("Gonad: All bfactor + all data")  # normality tests for the anova model - asign
              
              
              DF_loop$ShapiroWilk <- shapiro.test(resid(AOVmod))[[2]]
              DF_loop$ResidNorm   <- if( shapiro.test(resid(AOVmod))[[2]] > 0.05) {
                  'YES'} else {'NO'}
              DF_loop$Levenes     <- leveneTest(AOVmod)[[3]][[1]]
              DF_loop$HomogVar    <- if( leveneTest(AOVmod)[[3]][[1]] > 0.05) {
                  'YES'} else {'NO'}
                
              if(shapiro.test(resid(AOVmod))[[2]] > 0.05 & leveneTest(AOVmod)[[3]][[1]] > 0.05) {
                    DF_loop$model       <- 'one-way AOV; x ~ treatment'
                    DF_loop$DF.num      <- summary(AOVmod)[[1]][["Df"]][1]
                    DF_loop$DF.denom    <- summary(AOVmod)[[1]][["Df"]][2]
                    DF_loop$F_val       <- summary(AOVmod)[[1]][["F value"]][1]
                    DF_loop$P_val       <- summary(AOVmod)[[1]][["Pr(>F)"]][1]
                    DF_loop$SigDif      <- if( (summary(AOVmod)[[1]][["Pr(>F)"]][1]) > 0.05) {
                      'NO'} else {'YES'}
            
                  } else {
                    DF_loop$model       <- 'kruskal-wallis; x ~ treatment'
                    DF_loop$DF.num      <- (KWmod)[[2]][["df"]][1]
                    DF_loop$DF.denom    <- NA
                    DF_loop$F_val       <- NA
                    DF_loop$P_val       <- (KWmod)[[3]]
                    DF_loop$SigDif      <- if( ((KWmod)[[3]]) > 0.05) {
                      'NO'} else {'YES'}
                  }
              DF_loop$Age_DPF     <- GROUPvar_loop
              # asign loop and cumulative output table
              df                        <- data.frame(DF_loop) # name dataframe for this single row
              outputfilename <- rbind(outputfilename,DF_loop) #bind to a cumulative list dataframe
              # print(outputfilename) # print to monitor progress
              
             } # m loop
            } # i loop
return(outputfilename)
}


run_ttest <- function(datafilename,  outputfilename) {
            # variables for both for loops
            DF_loop           <- data.frame(matrix(nrow = 1, ncol = 13)) # create dataframe to save during for loop
            colnames(DF_loop) <- c('Age_DPF', 'Metric', 'model', 'ShapiroWilk', 'ResidNorm', 'Variance', 
                                   'HomogVar', 'DF.num' , 'DF.denom', 
                                   'Tstat','P_val', 'SigDif') # names for comuns in the for loop
            
            outputfilename <- data.frame()
            datafilename$value = as.numeric(datafilename$value)
            
            for (m in 1:length(unique(datafilename$type))) { # call the biodep metrics one by one
              
              DPvar_loop <- unique(as.character(datafilename$type))
              Data_DPvar <- datafilename %>% 
                                select(type, GROUPvar, DPvar, INDvar) %>% 
                                dplyr::filter(type %in%  DPvar_loop[m])
              
            
            for (i in 1:length(unique(Data_DPvar$GROUPvar))) {
              GROUPvar_loop <- unique(Data_DPvar$GROUPvar)[i] # Group var is Age (Date) 
              Data_by_day   <- Data_DPvar %>% dplyr::filter(GROUPvar %in% GROUPvar_loop)
              # Data_mean   <- Data_all %>% summarySE(measurevar="DPvar", 
              #                                       groupvars=c("group1","Tank_Replicate", "INDvar")) 
              
            # run assumptions 
            # normality of data 
            normality_A <- (Data_by_day %>% 
                                  group_by(as.factor(INDvar)) %>% 
                                  rstatix::shapiro_test(DPvar))$p[1]
            
            normality_B <- (Data_by_day %>% 
                                  group_by(as.factor(INDvar)) %>% 
                                  rstatix::shapiro_test(DPvar))$p[2]
            
            # equal variance 
            variance <- (Data_by_day %>% rstatix::levene_test(DPvar ~ as.factor(INDvar)))$p[1]
            
            # run all modles
            Ttestmod.eqvar      <- t.test(Data_by_day$DPvar ~ (as.factor(Data_by_day$INDvar)), 
                                           alternative = "greater",
                                           var.equal = TRUE)
            
            Ttestmod.noneqvar   <- t.test(Data_by_day$DPvar ~ (as.factor(Data_by_day$INDvar)),
                                           alternative = "greater",
                                           var.equal = FALSE)
            
            Wilcoxmod           <- wilcox.test(Data_by_day$DPvar ~ 
                                                 as.numeric(as.factor(Data_by_day$INDvar)))
            
            # normality tests for the anova model - asign 
            DF_loop$ShapiroWilk <- paste0(normality_A, '; ',normality_B)
            
            DF_loop$ResidNorm   <- if(normality_A > 0.05 & normality_B > 0.05) {
              'YES'} else {'NO'}
            
            DF_loop$Variance     <- variance
            
            DF_loop$HomogVar    <- if( variance > 0.05) {
              'YES'} else {'NO'}
            
            if(normality_A > 0.05 & normality_B > 0.05 & variance > 0.05) {
                DF_loop$model       <- 'Welchs T test, equal variance'
                DF_loop$DF.num      <- map_df(list(Ttestmod.eqvar), tidy)$parameter[[1]]
                DF_loop$DF.denom    <- 'NA'
                DF_loop$Tstat       <- map_df(list(Ttestmod.eqvar), tidy)$statistic[[1]]
                DF_loop$P_val       <- map_df(list(Ttestmod.eqvar), tidy)$p.value[[1]]
                DF_loop$SigDif      <- if( (map_df(list(Ttestmod.eqvar), tidy)$p.value[[1]]) > 0.05) {
                  'NO'} else {'YES'}
        
              } else if (normality_A > 0.05 & normality_B > 0.05 & variance < 0.05) {
                DF_loop$model       <- 'Welchs T test, non-equal variance'
                DF_loop$DF.num      <- map_df(list(Ttestmod.noneqvar), tidy)$parameter[[1]]
                DF_loop$DF.denom    <- 'NA'
                DF_loop$Tstat       <- map_df(list(Ttestmod.noneqvar), tidy)$statistic[[1]]
                DF_loop$P_val       <- map_df(list(Ttestmod.noneqvar), tidy)$p.value[[1]]
                DF_loop$SigDif      <- if( (map_df(list(Ttestmod.noneqvar), tidy)$p.value[[1]]) > 0.05) {
                  'NO'} else {'YES'}
              } else {
                DF_loop$model       <- 'Wilcoxon rank sum exact test'
                DF_loop$DF.num      <- 'NA'
                DF_loop$DF.denom    <- 'NA'
                DF_loop$Tstat       <- map_df(list(Wilcoxmod), tidy)$statistic[[1]]
                DF_loop$P_val       <- map_df(list(Wilcoxmod), tidy)$p.value[[1]]
                DF_loop$SigDif      <- if( (map_df(list(Wilcoxmod), tidy)$p.value[[1]]) > 0.05) {
                  'NO'} else {'YES'}            
              }
                  DF_loop$Age_DPF     <- GROUPvar_loop
                  DF_loop$Metric      <- DPvar_loop[m]
                  # asign loop and cumulative output table
                  df                        <- data.frame(DF_loop) # name dataframe for this single row
                  outputfilename <- rbind(outputfilename,DF_loop) #bind to a cumulative list dataframe
                  # print(outputfilename) # print to monitor progress
            }
                }
return(outputfilename)
}


```



```{r Long foramat in prep for loop stats}
library(data.table)

# select target columns 
Biodep_Master_F2_select <- Biodep_Master_F2 %>% select(Age,treatment,
                                                       RR_mghr, ORR_mghr, IRR_mghr,ER_mghr,OER_mghr,IER_mghr,        
                                                       IER_correct,IRR_correct,OER_correct,ORR_correct,CR,
                                                       FR,RR_correct,SE,IFR,CR_correct,FR_correct,RR_Percent,
                                                       TIR,OFR,OIR,i,AR, AE)

# long format ready for lop stats
Biodep_Master_F2_long <- as.data.frame(reshape2::melt(setDT(Biodep_Master_F2_select), 
                                                      id.vars = c("Age","treatment"), 
                                                      variable.name = "type")
                                      )


# call the variables needed
Biodep_Master_F2_long$DPvar    <- Biodep_Master_F2_long$value
Biodep_Master_F2_long$INDvar   <- Biodep_Master_F2_long$treatment
Biodep_Master_F2_long$GROUPvar <- Biodep_Master_F2_long$Age

# run the t test loop
F2_Biodeposition_Ttest_Wilcox_LowvMod <- as.data.frame(run_ttest(
                                    Biodep_Master_F2_long  %>%  filter(!INDvar == 7.0)
                                    )
                                    )

# run the t test loop
F2_Biodeposition_Ttest_Wilcox_LowvHigh <- as.data.frame(run_ttest(
                                    Biodep_Master_F2_long  %>%  filter(!INDvar == 7.5)
                                    )
                                    )
View(F2_Biodeposition_Ttest_Wilcox_LowvHigh)
# output stats
write.csv(F2_Biodeposition_Ttest_Wilcox_LowvMod, "Output/Biodeposition/F2/F2_Biodeposition_Ttest_table_LowvMod.csv")

write.csv(F2_Biodeposition_Ttest_Wilcox_LowvHigh, "Output/Biodeposition/F2/F2_Biodeposition_Ttest_table_LowvHigh.csv")


```











```{r two way anovas}

library(rcompanion)
library(FSA)

# Absorption Efficiency
AOV_AE <- lm(AE ~ as.factor(Age)*as.factor(treatment),data = Biodep_Master_F2)
shapiro.test(resid(AOV_AE)) # 6.484e-05
SRH_AE <- scheirerRayHare(AE ~ as.factor(Age)*as.factor(treatment),data = Biodep_Master_F2)
#               Df  Sum Sq      H p.value
# Age            2 13054.6 41.421 0.00000
# treatment      2  1195.7  3.794 0.15004
# Age:treatment  4   719.8  2.284 0.68368
DT_AE <- dunnTest(AE ~ as.factor(Age),
              data=Biodep_Master_F2,
              method="bh") 
DT_AE





# Absorption Efficiency
AOV_SE <- lm(SE ~ as.factor(Age)*as.factor(treatment),data = Biodep_Master_F2)
shapiro.test(resid(AOV_SE)) # 1.547e-07
SRH_SE <- scheirerRayHare(SE ~ as.factor(Age)*as.factor(treatment),data = Biodep_Master_F2)
#               Df Sum Sq       H p.value
# Age            2 9103.0 28.8832 0.00000
# treatment      2  661.1  2.0977 0.35034
# Age:treatment  4 2400.6  7.6169 0.10666
DT_SE <- dunnTest(SE ~ as.factor(Age),
              data=Biodep_Master_F2,
              method="bh") 
DT_SE



# Absorption ERate
AOV_AR <- lm(AR ~ as.factor(Age)*as.factor(treatment),data = Biodep_Master_F2)
shapiro.test(resid(AOV_AR)) # 0.001217
SRH_AR <- scheirerRayHare(AR ~ as.factor(Age)*as.factor(treatment),data = Biodep_Master_F2)
#               Df  Sum Sq      H p.value
# Age            2 14098.4 44.733 0.00000
# treatment      2   775.4  2.460 0.29223
# Age:treatment  4   655.3  2.079 0.72116
DT_AR <- dunnTest(AR ~ as.factor(Age),
              data=Biodep_Master_F2,
              method="bh") 
DT_AR




# Clearance Rate (corrected)
AOV_CR <- lm(CR_correct ~ as.factor(Age)*as.factor(treatment),data = Biodep_Master_F2)
shapiro.test(resid(AOV_CR)) # 0.01118
SRH_CR <- scheirerRayHare(CR ~ as.factor(Age)*as.factor(treatment),data = Biodep_Master_F2)
#               Df Sum Sq       H p.value
# Age            2 8939.6 28.3648 0.00000
# treatment      2 2411.5  7.6515 0.02180
# Age:treatment  4  218.5  0.6933 0.95216
DT_CR <- dunnTest(CR ~ as.factor(treatment),
              data=Biodep_Master_F2,
              method="bh") 
DT_CR
DT_CR <- dunnTest(CR ~ as.factor(Age),
              data=Biodep_Master_F2,
              method="bh") 
DT_CR





# Rejection Rate (corrected)
AOV_RR <- lm(RR_correct ~ as.factor(Age)*as.factor(treatment),data = Biodep_Master_F2)
shapiro.test(resid(AOV_RR)) # 0.04109
SRH_RR <- scheirerRayHare(RR_correct ~ as.factor(Age)*as.factor(treatment),data = Biodep_Master_F2)
SRH_RR
#               Df  Sum Sq       H  p.value
# Age            2  4894.2 15.5290 0.000425
# treatment      2  1028.5  3.2632 0.195613
# Age:treatment  4  1640.2  5.2042 0.266977
DT_RR <- dunnTest(RR_correct ~ as.factor(Age),
              data=Biodep_Master_F2,
              method="bh") 
DT_RR

# Organic Ingestion Rate
AOV_OIR <- lm(OIR ~ as.factor(Age)*as.factor(treatment),data = Biodep_Master_F2)
shapiro.test(resid(AOV_OIR)) # 0.007734
SRH_OIR <- scheirerRayHare(OIR ~ as.factor(Age)*as.factor(treatment),data = Biodep_Master_F2)
SRH_OIR
#               Df  Sum Sq      H p.value
# Age            2 13441.4 42.649 0.00000
# treatment      2   654.2  2.076 0.35422
# Age:treatment  4   586.4  1.861 0.76138
DT_OIR <- dunnTest(OIR ~ as.factor(Age),
              data=Biodep_Master_F2,
              method="bh") 
DT_OIR
```


```{r plots low moderate and high}

# what effects are sigificnat?
AOVdf_total %>% dplyr::filter(P_val < 0.05) %>% dplyr::select(Date, Metric)


# ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
# PLOTTING :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
# ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

# Selection Efficiency

F2_SE_MEANS <- summarySE(Biodep_Master_F2, measurevar="SE", 
                              groupvars=c("Age", "pCO2"))

F2_SE_Plot  <- F2_SE_MEANS %>% 
                          ggplot(aes(x=as.factor(Age), 
                                     y=SE, 
                                     color=as.factor(pCO2))) +
                          geom_point(position=position_dodge(.5))+ 
                          scale_color_manual(values=c("forestgreen",
                                                      "darkorange2",
                                                      "purple3"))+
                          geom_errorbar(aes(ymin=SE-se, 
                                            ymax=SE+se), width=.2,
                                        position=position_dodge(.5))+
                          ggtitle("Selection Efficiency") +
                          theme_classic() +  
                          xlab("Age (dpf)") +
                         #xlab("Age (d)") +
                          theme(panel.grid.major = element_blank(), 
                                panel.grid.minor = element_blank(),
                                legend.position = "none")+ 
                          scale_y_continuous(name ="Selection Efficiency")+
                          geom_line(stat = "identity", size=1.0)+
                          theme(text = element_text(size=10))

# Orgnaic Ingestion Rate

F2_OIR_MEANS <- summarySE(Biodep_Master_F2, measurevar="OIR", 
                              groupvars=c("Age", "pCO2"))

F2_OIR_Plot  <- F2_OIR_MEANS %>% 
                          ggplot(aes(x=as.factor(Age), 
                                     y=OIR, 
                                     color=as.factor(pCO2))) +
                          geom_point(position=position_dodge(.5))+ 
                          scale_color_manual(values=c("forestgreen",
                                                      "darkorange2",
                                                      "purple3"))+
                          geom_errorbar(aes(ymin=OIR-se, 
                                            ymax=OIR+se), width=.2,
                                        position=position_dodge(.5))+
                          ggtitle("Organic Ingestion Rate") +
                          theme_classic() +  
                          xlab("Age (dpf)") +
                         #xlab("Age (d)") +
                          theme(panel.grid.major = element_blank(), 
                                panel.grid.minor = element_blank(),
                                legend.position = "none")+ 
                          scale_y_continuous(name ="Orgnaic Ingestion Rate")+
                          geom_line(stat = "identity", size=1.0)+
                          theme(text = element_text(size=10))


# Clearance Rate (corrected)

F2_CR_correct_MEANS <- summarySE(Biodep_Master_F2, measurevar="CR_correct", 
                              groupvars=c("Age", "pCO2"))

F2_CR_correct_Plot  <- F2_CR_correct_MEANS %>% 
                          ggplot(aes(x=as.factor(Age), 
                                     y=CR_correct, 
                                     color=as.factor(pCO2))) +
                          geom_point(position=position_dodge(.5))+ 
                          scale_color_manual(values=c("forestgreen",
                                                      "darkorange2",
                                                      "purple3"))+
                          geom_errorbar(aes(ymin=CR_correct-se, 
                                            ymax=CR_correct+se), width=.2,
                                        position=position_dodge(.5))+
                          ggtitle("Clearance Rate (corrected)") +
                          theme_classic() +  
                          xlab("Age (dpf)") +
                         #xlab("Age (d)") +
                          theme(panel.grid.major = element_blank(), 
                                panel.grid.minor = element_blank(),
                                legend.position = "none")+ 
                          scale_y_continuous(name ="Clearance Rate (corrected)")+
                          geom_line(stat = "identity", size=1.0)+
                          theme(text = element_text(size=10))

# Rejection Rate (corrected)

F2_RR_correct_MEANS <- summarySE(Biodep_Master_F2, measurevar="RR_correct", 
                              groupvars=c("Age", "pCO2"))

F2_RR_correct_Plot  <- F2_RR_correct_MEANS %>% 
                          ggplot(aes(x=as.factor(Age), 
                                     y=RR_correct, 
                                     color=as.factor(pCO2))) +
                          geom_point(position=position_dodge(.5))+ 
                          scale_color_manual(values=c("forestgreen",
                                                      "darkorange2",
                                                      "purple3"))+
                          geom_errorbar(aes(ymin=RR_correct-se, 
                                            ymax=RR_correct+se), width=.2,
                                        position=position_dodge(.5))+
                          ggtitle("Rejection Rate (corrected)") +
                          theme_classic() +  
                          xlab("Age (dpf)") +
                         #xlab("Age (d)") +
                          theme(panel.grid.major = element_blank(), 
                                panel.grid.minor = element_blank(),
                                legend.position = "none")+  
                          scale_y_continuous(name ="Rejection Rate (corrected)")+
                          geom_line(stat = "identity", size=1.0)+
                          theme(text = element_text(size=10))

# Absorption Rate 

F2_AR_MEANS <- summarySE(Biodep_Master_F2, measurevar="AR", 
                              groupvars=c("Age", "pCO2"))

F2_AR_Plot  <- F2_AR_MEANS %>% 
                          ggplot(aes(x=as.factor(Age), 
                                     y=AR, 
                                     color=as.factor(pCO2))) +
                          geom_point(position=position_dodge(.5))+ 
                          scale_color_manual(values=c("forestgreen",
                                                      "darkorange2",
                                                      "purple3"))+
                          geom_errorbar(aes(ymin=AR-se, 
                                            ymax=AR+se), 
                                        width=.2,
                                        position=position_dodge(.5))+
                          ggtitle("Absorption Rate") +
                          theme_classic() +  
                          xlab("Age (dpf)") +
                         #xlab("Age (d)") +
                          theme(panel.grid.major = element_blank(), 
                                panel.grid.minor = element_blank(),
                                legend.position = "none")+ 
                          scale_y_continuous(name ="Absorption Rate")+
                          geom_line(stat = "identity", size=1.0)+
                          theme(text = element_text(size=10))

# Absorption Efficiency 

F2_AE_MEANS <- summarySE(Biodep_Master_F2, measurevar="AE", 
                              groupvars=c("Age", "pCO2"))

F2_AE_Plot  <- F2_AE_MEANS %>% 
                          ggplot(aes(x=as.factor(Age), 
                                     y=AE, 
                                     color=as.factor(pCO2))) +
                          geom_point(position=position_dodge(.5))+ 
                          scale_color_manual(values=c("forestgreen",
                                                      "darkorange2",
                                                      "purple3"))+
                          geom_errorbar(aes(ymin=AE-se, 
                                            ymax=AE+se), 
                                        width=.2,
                                        position=position_dodge(.5))+
                          ggtitle("Absorption Efficiency") +
                          theme_classic() +  
                          xlab("Age (dpf)") +
                         #xlab("Age (d)") +
                          theme(panel.grid.major = element_blank(), 
                                panel.grid.minor = element_blank(),
                                legend.position = "none")+ 
                          scale_y_continuous(name ="Absorption Efficiency")+
                          geom_line(stat = "identity", size=1.0)+
                          theme(text = element_text(size=10))

ggpubr::ggarrange(F2_OIR_Plot,F2_RR_correct_Plot, F2_CR_correct_Plot,
          F2_SE_Plot, F2_AR_Plot, F2_AE_Plot,
          ncol = 3, nrow = 2)

# output the plot 
library(ggpubr)
pdf(paste0("Output/Biodeposition/F2/F2_Biodeposition_plots.pdf"), width = 10, height= 6)
ggpubr::ggarrange(F2_OIR_Plot,F2_RR_correct_Plot, F2_CR_correct_Plot,
          F2_SE_Plot, F2_AR_Plot, F2_AE_Plot,
          ncol = 3, nrow = 2)
dev.off()


```

```{r plots low and moderate}

# what effects are sigificnat?
AOVdf_total %>% dplyr::filter(P_val < 0.05) %>% dplyr::select(Date, Metric)


# ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
# PLOTTING :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
# ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

# Selection Efficiency

Biodep_Master_F2_LowvMod <- Biodep_Master_F2 %>% dplyr::filter(!pCO2 %in% "1200 μatm")


F2_SE_MEANS <- summarySE(Biodep_Master_F2_LowvMod , measurevar="SE", 
                              groupvars=c("Age", "pCO2"))

F2_SE_Plot  <- F2_SE_MEANS %>% 
                          ggplot(aes(x=as.factor(Age), 
                                     y=SE, 
                                     color=as.factor(pCO2))) +
                          geom_point(position=position_dodge(.5))+ 
                          scale_color_manual(values=c("forestgreen",
                                                      "darkorange2"))+
                          geom_errorbar(aes(ymin=SE-se, 
                                            ymax=SE+se), width=.2,
                                        position=position_dodge(.5))+
                          ggtitle("Selection Efficiency") +
                          theme_classic() +  
                          xlab("Age (dpf)") +
                         #xlab("Age (d)") +
                          theme(panel.grid.major = element_blank(), 
                                panel.grid.minor = element_blank(),
                                legend.position = "none")+ 
                          scale_y_continuous(name ="Selection Efficiency")+
                          geom_line(stat = "identity", size=1.0)+
                          theme(text = element_text(size=10))

# Orgnaic Ingestion Rate

F2_OIR_MEANS <- summarySE(Biodep_Master_F2_LowvMod, measurevar="OIR", 
                              groupvars=c("Age", "pCO2"))

F2_OIR_Plot  <- F2_OIR_MEANS %>% 
                          ggplot(aes(x=as.factor(Age), 
                                     y=OIR, 
                                     color=as.factor(pCO2))) +
                          geom_point(position=position_dodge(.5))+ 
                          scale_color_manual(values=c("forestgreen",
                                                      "darkorange2"))+
                          geom_errorbar(aes(ymin=OIR-se, 
                                            ymax=OIR+se), width=.2,
                                        position=position_dodge(.5))+
                          ggtitle("Organic Ingestion Rate") +
                          theme_classic() +  
                          xlab("Age (dpf)") +
                         #xlab("Age (d)") +
                          theme(panel.grid.major = element_blank(), 
                                panel.grid.minor = element_blank(),
                                legend.position = "none")+ 
                          scale_y_continuous(name ="Orgnaic Ingestion Rate")+
                          geom_line(stat = "identity", size=1.0)+
                          theme(text = element_text(size=10))


# Clearance Rate (corrected)

F2_CR_correct_MEANS <- summarySE(Biodep_Master_F2_LowvMod, measurevar="CR_correct", 
                              groupvars=c("Age", "pCO2"))

F2_CR_correct_Plot  <- F2_CR_correct_MEANS %>% 
                          ggplot(aes(x=as.factor(Age), 
                                     y=CR_correct, 
                                     color=as.factor(pCO2))) +
                          geom_point(position=position_dodge(.5))+ 
                          scale_color_manual(values=c("forestgreen",
                                                      "darkorange2"))+
                          geom_errorbar(aes(ymin=CR_correct-se, 
                                            ymax=CR_correct+se), width=.2,
                                        position=position_dodge(.5))+
                          ggtitle("Clearance Rate (corrected)") +
                          theme_classic() +  
                          xlab("Age (dpf)") +
                         #xlab("Age (d)") +
                          theme(panel.grid.major = element_blank(), 
                                panel.grid.minor = element_blank(),
                                legend.position = "none")+ 
                          scale_y_continuous(name ="Clearance Rate (corrected)")+
                          geom_line(stat = "identity", size=1.0)+
                          theme(text = element_text(size=10))

# Rejection Rate (corrected)

F2_RR_correct_MEANS <- summarySE(Biodep_Master_F2_LowvMod, measurevar="RR_correct", 
                              groupvars=c("Age", "pCO2"))

F2_RR_correct_Plot  <- F2_RR_correct_MEANS %>% 
                          ggplot(aes(x=as.factor(Age), 
                                     y=RR_correct, 
                                     color=as.factor(pCO2))) +
                          geom_point(position=position_dodge(.5))+ 
                          scale_color_manual(values=c("forestgreen",
                                                      "darkorange2"))+
                          geom_errorbar(aes(ymin=RR_correct-se, 
                                            ymax=RR_correct+se), width=.2,
                                        position=position_dodge(.5))+
                          ggtitle("Rejection Rate (corrected)") +
                          theme_classic() +  
                          xlab("Age (dpf)") +
                         #xlab("Age (d)") +
                          theme(panel.grid.major = element_blank(), 
                                panel.grid.minor = element_blank(),
                                legend.position = "none")+  
                          scale_y_continuous(name ="Rejection Rate (corrected)")+
                          geom_line(stat = "identity", size=1.0)+
                          theme(text = element_text(size=10))

# Absorption Rate 

F2_AR_MEANS <- summarySE(Biodep_Master_F2_LowvMod, measurevar="AR", 
                              groupvars=c("Age", "pCO2"))

F2_AR_Plot  <- F2_AR_MEANS %>% 
                          ggplot(aes(x=as.factor(Age), 
                                     y=AR, 
                                     color=as.factor(pCO2))) +
                          geom_point(position=position_dodge(.5))+ 
                          scale_color_manual(values=c("forestgreen",
                                                      "darkorange2"))+
                          geom_errorbar(aes(ymin=AR-se, 
                                            ymax=AR+se), 
                                        width=.2,
                                        position=position_dodge(.5))+
                          ggtitle("Absorption Rate") +
                          theme_classic() +  
                          xlab("Age (dpf)") +
                         #xlab("Age (d)") +
                          theme(panel.grid.major = element_blank(), 
                                panel.grid.minor = element_blank(),
                                legend.position = "none")+ 
                          scale_y_continuous(name ="Absorption Rate")+
                          geom_line(stat = "identity", size=1.0)+
                          theme(text = element_text(size=10))

# Absorption Efficiency 

F2_AE_MEANS <- summarySE(Biodep_Master_F2_LowvMod, measurevar="AE", 
                              groupvars=c("Age", "pCO2"))

F2_AE_Plot  <- F2_AE_MEANS %>% 
                          ggplot(aes(x=as.factor(Age), 
                                     y=AE, 
                                     color=as.factor(pCO2))) +
                          geom_point(position=position_dodge(.5))+ 
                          scale_color_manual(values=c("forestgreen",
                                                      "darkorange2"))+
                          geom_errorbar(aes(ymin=AE-se, 
                                            ymax=AE+se), 
                                        width=.2,
                                        position=position_dodge(.5))+
                          ggtitle("Absorption Efficiency") +
                          theme_classic() +  
                          xlab("Age (dpf)") +
                         #xlab("Age (d)") +
                          theme(panel.grid.major = element_blank(), 
                                panel.grid.minor = element_blank(),
                                legend.position = "none")+ 
                          scale_y_continuous(name ="Absorption Efficiency")+
                          geom_line(stat = "identity", size=1.0)+
                          theme(text = element_text(size=10))

ggpubr::ggarrange(F2_OIR_Plot,F2_RR_correct_Plot, F2_CR_correct_Plot,
          F2_SE_Plot, F2_AR_Plot, F2_AE_Plot,
          ncol = 3, nrow = 2)

# output the plot 
library(ggpubr)
pdf(paste0("Output/Biodeposition/F2/F2_Biodeposition_plots_LowvMod.pdf"), width = 10, height= 6)
ggpubr::ggarrange(F2_OIR_Plot,F2_RR_correct_Plot, F2_CR_correct_Plot,
          F2_SE_Plot, F2_AR_Plot, F2_AE_Plot,
          ncol = 3, nrow = 2)
dev.off()
```

```{r plots low and high}
# ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
# PLOTTING :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
# ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

# Selection Efficiency

Biodep_Master_F2_LowvHigh <- Biodep_Master_F2 %>% dplyr::filter(!pCO2 %in% "800 μatm")


F2_SE_MEANS <- summarySE(Biodep_Master_F2_LowvHigh , measurevar="SE", 
                              groupvars=c("Age", "pCO2"))

F2_SE_Plot  <- F2_SE_MEANS %>% 
                          ggplot(aes(x=as.factor(Age), 
                                     y=SE, 
                                     color=as.factor(pCO2))) +
                          geom_point(position=position_dodge(.5))+ 
                          scale_color_manual(values=c("forestgreen",
                                                      "purple"))+
                          geom_errorbar(aes(ymin=SE-se, 
                                            ymax=SE+se), width=.2,
                                        position=position_dodge(.5))+
                          ggtitle("Selection Efficiency") +
                          theme_classic() +  
                          xlab("Age (dpf)") +
                         #xlab("Age (d)") +
                          theme(panel.grid.major = element_blank(), 
                                panel.grid.minor = element_blank(),
                                legend.position = "none")+ 
                          scale_y_continuous(name ="Selection Efficiency")+
                          geom_line(stat = "identity", size=1.0)+
                          theme(text = element_text(size=10))

# Orgnaic Ingestion Rate

F2_OIR_MEANS <- summarySE(Biodep_Master_F2_LowvHigh, measurevar="OIR", 
                              groupvars=c("Age", "pCO2"))

F2_OIR_Plot  <- F2_OIR_MEANS %>% 
                          ggplot(aes(x=as.factor(Age), 
                                     y=OIR, 
                                     color=as.factor(pCO2))) +
                          geom_point(position=position_dodge(.5))+ 
                          scale_color_manual(values=c("forestgreen",
                                                      "purple"))+
                          geom_errorbar(aes(ymin=OIR-se, 
                                            ymax=OIR+se), width=.2,
                                        position=position_dodge(.5))+
                          ggtitle("Organic Ingestion Rate") +
                          theme_classic() +  
                          xlab("Age (dpf)") +
                         #xlab("Age (d)") +
                          theme(panel.grid.major = element_blank(), 
                                panel.grid.minor = element_blank(),
                                legend.position = "none")+ 
                          scale_y_continuous(name ="Orgnaic Ingestion Rate")+
                          geom_line(stat = "identity", size=1.0)+
                          theme(text = element_text(size=10))


# Clearance Rate (corrected)

F2_CR_correct_MEANS <- summarySE(Biodep_Master_F2_LowvHigh, measurevar="CR_correct", 
                              groupvars=c("Age", "pCO2"))

F2_CR_correct_Plot  <- F2_CR_correct_MEANS %>% 
                          ggplot(aes(x=as.factor(Age), 
                                     y=CR_correct, 
                                     color=as.factor(pCO2))) +
                          geom_point(position=position_dodge(.5))+ 
                          scale_color_manual(values=c("forestgreen",
                                                      "purple"))+
                          geom_errorbar(aes(ymin=CR_correct-se, 
                                            ymax=CR_correct+se), width=.2,
                                        position=position_dodge(.5))+
                          ggtitle("Clearance Rate (corrected)") +
                          theme_classic() +  
                          xlab("Age (dpf)") +
                         #xlab("Age (d)") +
                          theme(panel.grid.major = element_blank(), 
                                panel.grid.minor = element_blank(),
                                legend.position = "none")+ 
                          scale_y_continuous(name ="Clearance Rate (corrected)")+
                          geom_line(stat = "identity", size=1.0)+
                          theme(text = element_text(size=10))

# Rejection Rate (corrected)

F2_RR_correct_MEANS <- summarySE(Biodep_Master_F2_LowvHigh, measurevar="RR_correct", 
                              groupvars=c("Age", "pCO2"))

F2_RR_correct_Plot  <- F2_RR_correct_MEANS %>% 
                          ggplot(aes(x=as.factor(Age), 
                                     y=RR_correct, 
                                     color=as.factor(pCO2))) +
                          geom_point(position=position_dodge(.5))+ 
                          scale_color_manual(values=c("forestgreen",
                                                      "purple"))+
                          geom_errorbar(aes(ymin=RR_correct-se, 
                                            ymax=RR_correct+se), width=.2,
                                        position=position_dodge(.5))+
                          ggtitle("Rejection Rate (corrected)") +
                          theme_classic() +  
                          xlab("Age (dpf)") +
                         #xlab("Age (d)") +
                          theme(panel.grid.major = element_blank(), 
                                panel.grid.minor = element_blank(),
                                legend.position = "none")+  
                          scale_y_continuous(name ="Rejection Rate (corrected)")+
                          geom_line(stat = "identity", size=1.0)+
                          theme(text = element_text(size=10))

# Absorption Rate 

F2_AR_MEANS <- summarySE(Biodep_Master_F2_LowvHigh, measurevar="AR", 
                              groupvars=c("Age", "pCO2"))

F2_AR_Plot  <- F2_AR_MEANS %>% 
                          ggplot(aes(x=as.factor(Age), 
                                     y=AR, 
                                     color=as.factor(pCO2))) +
                          geom_point(position=position_dodge(.5))+ 
                          scale_color_manual(values=c("forestgreen",
                                                      "purple"))+
                          geom_errorbar(aes(ymin=AR-se, 
                                            ymax=AR+se), 
                                        width=.2,
                                        position=position_dodge(.5))+
                          ggtitle("Absorption Rate") +
                          theme_classic() +  
                          xlab("Age (dpf)") +
                         #xlab("Age (d)") +
                          theme(panel.grid.major = element_blank(), 
                                panel.grid.minor = element_blank(),
                                legend.position = "none")+ 
                          scale_y_continuous(name ="Absorption Rate")+
                          geom_line(stat = "identity", size=1.0)+
                          theme(text = element_text(size=10))

# Absorption Efficiency 

F2_AE_MEANS <- summarySE(Biodep_Master_F2_LowvHigh, measurevar="AE", 
                              groupvars=c("Age", "pCO2"))

F2_AE_Plot  <- F2_AE_MEANS %>% 
                          ggplot(aes(x=as.factor(Age), 
                                     y=AE, 
                                     color=as.factor(pCO2))) +
                          geom_point(position=position_dodge(.5))+ 
                          scale_color_manual(values=c("forestgreen",
                                                      "purple"))+
                          geom_errorbar(aes(ymin=AE-se, 
                                            ymax=AE+se), 
                                        width=.2,
                                        position=position_dodge(.5))+
                          ggtitle("Absorption Efficiency") +
                          theme_classic() +  
                          xlab("Age (dpf)") +
                         #xlab("Age (d)") +
                          theme(panel.grid.major = element_blank(), 
                                panel.grid.minor = element_blank(),
                                legend.position = "none")+ 
                          scale_y_continuous(name ="Absorption Efficiency")+
                          geom_line(stat = "identity", size=1.0)+
                          theme(text = element_text(size=10))


# output the plot 
library(ggpubr)
pdf(paste0("Output/Biodeposition/F2/F2_Biodeposition_plots_LowvHigh.pdf"), width = 10, height= 6)
ggpubr::ggarrange(F2_OIR_Plot,F2_RR_correct_Plot, F2_CR_correct_Plot,
          F2_SE_Plot, F2_AR_Plot, F2_AE_Plot,
          ncol = 3, nrow = 2)
dev.off()
```


# F2S ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

Biodep_Master_F2$pCO2 <- factor(Biodep_Master_F2$pCO2, 
                                levels = c("500 μatm", "800 μatm", "1200 μatm"))


AE_boxplot_F2 <- Biodep_Master_F2 %>% 
  ggplot(aes(pCO2 , AE , fill = pCO2)) +
  theme(panel.grid=element_blank()) +
  geom_boxplot(size=0.2, alpha=0.1, aes(fill=pCO2)) +
  scale_fill_manual(values=c("forestgreen","orange", "purple")) +
  geom_point(shape = 21, size = 2, position = position_jitterdodge(jitter.width = 0.1)) +
  theme_classic() +
  theme(axis.text=element_text(size=6),
        axis.title=element_text(size=6)) +
  stat_summary(fun.y=mean, geom="point", shape=18, size=4, color="black", fill="white") +
  ggtitle("Assimilation Efficiency, F2 Scallops") +
  theme(axis.text.x=element_blank()) +
  facet_wrap(~Date)
# AE_boxplot


AR_boxplot_F2 <- Biodep_Master_F2 %>% 
  ggplot(aes(pCO2 , AR , fill = pCO2)) +
  theme(panel.grid=element_blank()) +
  geom_boxplot(size=0.2, alpha=0.1, aes(fill=pCO2)) +
  scale_fill_manual(values=c("forestgreen","orange", "purple")) +
  geom_point(shape = 21, size = 2, position = position_jitterdodge(jitter.width = 0.1)) +
  theme_classic() +
  theme(axis.text=element_text(size=6),
        axis.title=element_text(size=6)) +
  stat_summary(fun.y=mean, geom="point", shape=18, size=4, color="black", fill="white") +
  ggtitle("Assimilation Rate, F2 Scallops") +
  theme(axis.text.x=element_blank()) +
  facet_wrap(~Date)
# AR_boxplot

OIR_boxplot_F2 <- Biodep_Master_F2 %>% 
  ggplot(aes(pCO2 , OIR , fill = pCO2)) +
  theme(panel.grid=element_blank()) +
  geom_boxplot(size=0.2, alpha=0.1, aes(fill=pCO2)) +
  scale_fill_manual(values=c("forestgreen","orange", "purple")) +
  geom_point(shape = 21, size = 2, position = position_jitterdodge(jitter.width = 0.1)) +
  theme_classic() +
  theme(axis.text=element_text(size=6),
        axis.title=element_text(size=6)) +
  stat_summary(fun.y=mean, geom="point", shape=18, size=4, color="black", fill="white") +
  ggtitle("Organic Ingestion Rate, F2 Scallops") +
  theme(axis.text.x=element_blank()) +
  facet_wrap(~Date)
# OIR_boxplot


FR_boxplot_F2 <- Biodep_Master_F2 %>% 
  ggplot(aes(pCO2 , FR , fill = pCO2)) +
  theme(panel.grid=element_blank()) +
  geom_boxplot(size=0.2, alpha=0.1, aes(fill=pCO2)) +
  scale_fill_manual(values=c("forestgreen","orange", "purple")) +
  geom_point(shape = 21, size = 2, position = position_jitterdodge(jitter.width = 0.1)) +
  theme_classic() +
  theme(axis.text=element_text(size=6),
        axis.title=element_text(size=6)) +
  stat_summary(fun.y=mean, geom="point", shape=18, size=4, color="black", fill="white") +
  ggtitle("Filtration Rate, F2 Scallops") +
  theme(axis.text.x=element_blank()) +
  facet_wrap(~Date)
# FR_boxplot

RR_boxplot_F2 <- Biodep_Master_F2 %>% 
  ggplot(aes(pCO2 , RR_Percent , fill = pCO2)) +
  theme(panel.grid=element_blank()) +
  geom_boxplot(size=0.2, alpha=0.1, aes(fill=pCO2)) +
  scale_fill_manual(values=c("forestgreen","orange", "purple")) +
  geom_point(shape = 21, size = 2, position = position_jitterdodge(jitter.width = 0.1)) +
  theme_classic() +
  theme(axis.text=element_text(size=6),
        axis.title=element_text(size=6)) +
  stat_summary(fun.y=mean, geom="point", shape=18, size=4, color="black", fill="white") +
  ggtitle("Percent Rejection Rate, F2 Scallops") +
  theme(axis.text.x=element_blank()) +
  facet_wrap(~Date)
# RR_boxplot

SE_boxplot_F2 <- Biodep_Master_F2 %>% 
  ggplot(aes(pCO2 , SE , fill = pCO2)) +
  theme(panel.grid=element_blank()) +
  geom_boxplot(size=0.2, alpha=0.1, aes(fill=pCO2)) +
  scale_fill_manual(values=c("forestgreen","orange", "purple")) +
  geom_point(shape = 21, size = 2, position = position_jitterdodge(jitter.width = 0.1)) +
  theme_classic() +
  theme(axis.text=element_text(size=6),
        axis.title=element_text(size=6)) +
  stat_summary(fun.y=mean, geom="point", shape=18, size=4, color="black", fill="white") +
  ggtitle("Selection Efficiency, F2 Scallops") +
  theme(axis.text.x=element_blank()) +
  facet_wrap(~Date)
# SE_boxplot

# output the plot 
library(ggpubr)
pdf(paste0("C:/Users/samjg/Documents/Github_repositories/Airradians_multigen_OA/RAnalysis/Output/Biodeposition/F2_Biodeposition_Boxplots.pdf"), width = 10, height= 8)
ggarrange(SE_boxplot_F2,
          RR_boxplot_F2, 
          OIR_boxplot_F2, 
          FR_boxplot_F2, 
          AE_boxplot_F2, 
          AR_boxplot_F2)
dev.off()










































CR_correct_boxplot <- Biodep_Master %>% 
  dplyr::mutate(Temperature = case_when(Date == '20220302' ~ '16C', 
                                        Date == '20220923' ~ '20C',
                                        Date == '20221027' ~ '13.3C')) %>%  
  #filter(!AE < 0) %>% 
  ggplot(aes(pCO2 , CR_correct , fill = pCO2)) +
  theme(panel.grid=element_blank()) +
  geom_boxplot(size=0.2, alpha=0.1, aes(fill=pCO2)) +
  scale_fill_manual(values=c("forestgreen","orange")) +
  geom_point(shape = 21, size = 2, position = position_jitterdodge(jitter.width = 0.1)) +
  theme_classic() +
  theme(axis.text=element_text(size=6),
        axis.title=element_text(size=6)) +
  stat_summary(fun.y=mean, geom="point", shape=18, size=4, color="black", fill="white") +
  ggtitle("Clearance Rate, F1 Scallops") +
  theme(axis.text.x=element_blank()) +
  facet_wrap(~Temperature)
CR_correct_boxplot
 





#  KAITE'S mas POSTER FIGURE FOR MAS 2022

Biodep_Master_16_20C <- Biodep_Master %>% 
  dplyr::mutate(Temperature = case_when(Date == '20220302' ~ '16C', 
                                        Date == '20220923' ~ '20C',
                                        Date == '20221027' ~ '13.3C')) %>%  
  dplyr::filter(Temperature %in% c('16C', '20C'))



AE_boxplot <- Biodep_Master_16_20C %>% 
  ggplot(aes(pCO2 , AE , fill = pCO2)) +
  theme(panel.grid=element_blank()) +
  geom_boxplot(size=0.2, alpha=0.1, aes(fill=pCO2)) +
  scale_fill_manual(values=c("forestgreen","orange")) +
  geom_point(shape = 21, size = 2, position = position_jitterdodge(jitter.width = 0.1)) +
  theme_classic() +
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12)) +
  stat_summary(fun.y=mean, geom="point", shape=18, size=4, color="black", fill="white") +
  ggtitle("Assimilation Efficiency") +
  theme(axis.text.x=element_blank(),axis.title.x = element_blank()) +
  facet_wrap(~Temperature)
# AE_boxplot

OIR_boxplot <- Biodep_Master_16_20C %>% 
  ggplot(aes(pCO2 , OIR , fill = pCO2)) +
  theme(panel.grid=element_blank()) +
  geom_boxplot(size=0.2, alpha=0.1, aes(fill=pCO2)) +
  scale_fill_manual(values=c("forestgreen","orange")) +
  geom_point(shape = 21, size = 2, position = position_jitterdodge(jitter.width = 0.1)) +
  theme_classic() +
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12)) +
  stat_summary(fun.y=mean, geom="point", shape=18, size=4, color="black", fill="white") +
  ggtitle("Organic Ingestion Rate") +
  theme(axis.text.x=element_blank(),axis.title.x = element_blank(),legend.position = "none") +
  facet_wrap(~Temperature)
# OIR_boxplot


FR_boxplot <- Biodep_Master_16_20C %>% 
  ggplot(aes(pCO2 , FR , fill = pCO2)) +
  theme(panel.grid=element_blank()) +
  geom_boxplot(size=0.2, alpha=0.1, aes(fill=pCO2)) +
  scale_fill_manual(values=c("forestgreen","orange")) +
  geom_point(shape = 21, size = 2, position = position_jitterdodge(jitter.width = 0.1)) +
  theme_classic() +
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12)) +
  stat_summary(fun.y=mean, geom="point", shape=18, size=4, color="black", fill="white") +
  ggtitle("Filtration Rate") +
  theme(axis.text.x=element_blank(),axis.title.x = element_blank(),legend.position = "none") +
  facet_wrap(~Temperature)
# FR_boxplot

RR_boxplot <- Biodep_Master_16_20C %>% 
  ggplot(aes(pCO2 , RR_Percent , fill = pCO2)) +
  theme(panel.grid=element_blank()) +
  geom_boxplot(size=0.2, alpha=0.1, aes(fill=pCO2)) +
  scale_fill_manual(values=c("forestgreen","orange")) +
  geom_point(shape = 21, size = 2, position = position_jitterdodge(jitter.width = 0.1)) +
  theme_classic() +
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12)) +
  stat_summary(fun.y=mean, geom="point", shape=18, size=4, color="black", fill="white") +
  ggtitle("Percent Rejection Rate") +
  theme(axis.text.x=element_blank(),axis.title.x = element_blank(),legend.position = "none") +
  facet_wrap(~Temperature)
# RR_boxplot

SE_boxplot <- Biodep_Master_16_20C %>% 
  ggplot(aes(pCO2 , SE , fill = pCO2)) +
  theme(panel.grid=element_blank()) +
  geom_boxplot(size=0.2, alpha=0.1, aes(fill=pCO2)) +
  scale_fill_manual(values=c("forestgreen","orange")) +
  geom_point(shape = 21, size = 2, position = position_jitterdodge(jitter.width = 0.1)) +
  theme_classic() +
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12)) +
  stat_summary(fun.y=mean, geom="point", shape=18, size=4, color="black", fill="white") +
  ggtitle("Selection Efficiency") +
  theme(axis.text.x=element_blank(),axis.title.x = element_blank(),legend.position = "none") +
  facet_wrap(~Temperature)


pdf(paste0("C:/Users/samjg/Documents/Github_repositories/Airradians_multigen_OA/RAnalysis/Output/Biodeposition/Biodeposition_Boxplots_MAS_poster.pdf"), width = 20, height= 4)
ggarrange(SE_boxplot,RR_boxplot, OIR_boxplot, FR_boxplot, nrow = 1, ncol = 5)
dev.off()

pdf(paste0("C:/Users/samjg/Documents/Github_repositories/Airradians_multigen_OA/RAnalysis/Output/Biodeposition/AE_Boxplot_MAS_poster.pdf"), width = 5, height= 4)
ggarrange(AE_boxplot, nrow = 1, ncol = 1)
dev.off()